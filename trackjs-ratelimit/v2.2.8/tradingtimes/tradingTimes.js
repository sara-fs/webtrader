define(["exports","jquery","windows/windows","websockets/binary_websockets","navigation/menu","lodash","moment","../common/marketUtils","datatables","jquery-growl","common/util"],function(e,t,a,n,i,s,r,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0;var v=u(t),b=u(a),l=u(n),k=u(i),o=(u(s),u(r));function u(e){return e&&e.__esModule?e:{default:e}}var c=null,d=null,m=e.init=function(e){require(["css!tradingtimes/tradingTimes.css"]),e.click(function(){d?d.moveToTop():((d=b.default.createBlankWindow((0,v.default)("<div/>"),{title:"Trading Times".i18n(),dialogClass:"tradingTimes",width:800,height:400})).track({module_id:"tradingTimes",is_unique:!0,data:null}),d.dialog("open"),require(["text!tradingtimes/tradingTimes.html"],f))})},f=function(e){var f=(e=(0,v.default)(e).i18n()).filter(".trading-times-sub-header");c=e.filter("table"),e.appendTo(d),(c=c.dataTable({data:[],columnDefs:[{className:"dt-body-center dt-header-center",targets:[0,1,2,3,4]}],paging:!1,ordering:!1,searching:!0,processing:!0})).parent().addClass("hide-search-input"),c.api().columns().every(function(){var e=this;(0,v.default)("input",this.header()).on("keyup change",function(){e.search()!==this.value&&e.search(this.value).draw()})});function t(a){function m(e,t,a){var n=e.getRowsFor(t,a);c.api().rows().remove(),c.api().rows.add(n),c.api().draw()}function n(e){var n,a,i,s=(n=k.default.extractFilteredMarkets(e[0]),a=[],i={},(n=n||[]).filter(function(e){var t=(local_storage.get("authorize")||{}).loginid||"";return/MF/gi.test(t)&&"Synthetic Indices"!==e.name||/MLT/gi.test(t)&&"Synthetic Indices"===e.name||/MX/gi.test(t)&&"Synthetic Indices"===e.name||!/MF/gi.test(t)&&!/MLT/gi.test(t)&&!/MX/gi.test(t)}).forEach(function(t){a.push(t.display_name),i[t.display_name]=[],t.submarkets.forEach(function(e){i[t.display_name].push(e.display_name)})}),{market_names:a,submarket_names:i,getRowsFor:function(t,a){var e=n.filter(function(e){return e.display_name==t})[0];return(e&&e.submarkets.filter(function(e){return e.display_name==a})[0].instruments||[]).map(function(e){return[e.display_name,e.times.open[0],e.times.close[0],e.times.settlement||e.settlement||"-",e.events&&0<e.events.length?e.events.map(function(e){return e.descrip+": "+e.dates}).join("<br>"):"-"]})}}),t=local_storage.get("active_symbols"),r=filterRestrictedSymbols(t),l=(0,p.getObjectMarketSubmarkets)(r),o=(0,p.getSortedMarkets)(r);if(!v.default.isEmptyObject(l)){if(null==g){var u=(0,v.default)("<select />");u.appendTo(f),(g=b.default.makeSelectmenu(u,{list:o,inx:0})).off("selectmenuchange",d),g.on("selectmenuchange",d)}else g.update_list(o),g.off("selectmenuchange",d),g.on("selectmenuchange",d);if(null==h){var c=(0,v.default)("<select />");c.appendTo(f),(h=b.default.makeSelectmenu(c,{list:(0,p.getSortedSubmarkets)(Object.keys(l[g.val()])),inx:0,changed:null})).off("selectmenuchange",d),h.on("selectmenuchange",d)}else h.update_list((0,p.getSortedSubmarkets)(Object.keys(l[g.val()]))),h.off("selectmenuchange",d),h.on("selectmenuchange",d);m(s,g.val(),h.val())}function d(){var e=(0,v.default)(this).val(),t=local_storage.get("active_symbols"),a=filterRestrictedSymbols(t);if((l=(0,p.getObjectMarketSubmarkets)(a))[e]){var n=Object.keys(l[e]);h.update_list((0,p.getSortedSubmarkets)(n))}m(s,g.val(),h.val())}}function t(){var e={trading_times:a},t=(0,v.default)("#"+c.attr("id")+"_processing");t.show(),Promise.all([l.default.cached.send(e)]).then(function(e){n(e),t.hide()}).catch(function(e){v.default.growl.error({message:e.message}),t.hide()})}t(),require(["websockets/binary_websockets"],function(e){e.events.on("login",t),e.events.on("logout",t)})}var g=null,h=null;t(o.default.utc().format("YYYY-MM-DD"));var a=o.default.utc().add(1,"years").toDate();d.addDateToHeader({title:"Date: ",date:o.default.utc().toDate(),changed:t,maxDate:a})};e.default={init:m}});